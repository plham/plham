#!/bin/bash

# a.out や template.json を含むフォルダ（絶対パス）
#$1: ある現物銘柄だけを扱うエージェントの数

# パラメータを別ファイルに保存
echo "$@" >paramsLUN$1-G$2-baselrate$3-seed$4.txt

NUMPORT=$1

NUMLOCAL=$(echo "1000-${NUMLOCAL}" | bc)

NUMGOODS=$2

SETCASHLOCAL=15000.0

SETCASHPORT=$(echo "${SETCASHLOCAL}*${NUMGOODS}" | bc)

declare -i NUMNORMALPORT
declare -i NUMBASELPORT

declare -i NUMNORMALLOCAL
declare -i NUMBASELLOCAL
declare -i DIF

BASELPERCENT=$3


export NUMBASELLOCAL=$(echo "${BASELPERCENT}*${NUMLOCAL}/100" | bc)
export NUMNORMALLOCAL=$(echo "${NUMLOCAL}-${NUMBASELLOCAL}" | bc)

export NUMBASELPORT=$(echo "${BASELPERCENT}*${NUMPORT}/100" )
export NUMNORMALPORT=$(echo "${NUMPORT}-${NUMBASELPORT}" | bc)


#NUMNORMALLOCAL=${NUMLOCAL}
#NUMBASELLOCAL=0

#NUMNORMALPORT=${NUMPORT}
#NUMBASELPORT=0


export SUM=$(echo "${NUMNORMALLOCAL} + ${NUMBASELLOCAL} + ${NUMNORMALPORT} + ${NUMBASELPORT}" |bc)
SETNUMOPTION=$SUM


export SETMARKETCLUSTERS1=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETMARKETCLUSTERS1 $2`

export SETUNDERLYIGNMARKET1=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETUNDERLYIGNMARKET1 $2`

export SETNORMALLOCALAGENT1=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETNORMALLOCALAGENT1 $2`

export SETBASELLOCALAGENT1=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETBASELLOCALAGENT1 $2`

export SETOPTIONAGENT1=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETOPTIONAGENT1 $2`



export SETMARKETCLUSTERS2=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETMARKETCLUSTERS2 $2`

export SETUNDERLYIGNMARKET2=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETUNDERLYIGNMARKET2 $2`

export SETNORMALLOCALAGENT2=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETNORMALLOCALAGENT2 $2`

export SETBASELLOCALAGENT2=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETBASELLOCALAGENT2 $2`

export SETOPTIONAGENT2=`$HOME/programX10/plham-dev/samples/OptionPortfolio/SETMARKET.out SETOPTIONAGENT2 $2`


echo *MARKET

echo **NUMGOODS: "$NUMGOODS"

echo **SETMARKETCLUSTERS1:
echo "$SETMARKETCLUSTERS1"

echo **SETMARKETCLUSTERS2:
echo "$SETMARKETCLUSTERS2"

echo **SETUNDERLYIGNMARKET1:
echo "$SETUNDERLYIGNMARKET1"

echo **SETUNDERLYIGNMARKET2:
echo "$SETUNDERLYIGNMARKET2"


echo *AGENT

echo **LOCALAGENT

echo ***SETCASHLOCAL: "$SETCASHLOCAL"

echo ***NUMNORMALLOCAL: "$NUMNORMALLOCAL"

echo ***SETNORMALLOCALAGENT1:
echo "$SETNORMALLOCALAGENT1"
	
echo ***SETNORMALLOCALAGENT2:
echo "$SETNORMALLOCALAGENT2"

echo ***NUMBASELLOCAL:  "$NUMBASELLOCAL"

echo ***SETBASELLOCALAGENT1:
echo "$SETBASELLOCALAGENT1"

echo ***SETBASELLOCALAGENT2:
echo "$SETBASELLOCALAGENT2"

echo **PORTAGENT

echo ***SETCASHPORT: "$SETCASHPORT"

echo ***NUMNORMALPORT: "$NUMNORMALPORT"

echo ***NUMBASELPORT: "$NUMBASELPORT"	

echo **OPTION

echo ***SETNUMOPTION: "$SETNUMOPTION"

echo ***SETOPTIONAGENT1:
echo "$SETOPTIONAGENT1"

echo ***SETOPTIONAGENT2:
echo "$SETOPTIONAGENT2"

sed "s/NUMOPTIONAGENT/$SETNUMOPTION/g; s/SETNORMALLOCALAGENT2/$SETNORMALLOCALAGENT2/g;  s/SETBASELLOCALAGENT2/$SETBASELLOCALAGENT2/g;  s/SETMARKETCLUSTERS2/$SETMARKETCLUSTERS2/g; s/SETOPTIONAGENT2/$SETOPTIONAGENT2/g; s/SETUNDERLYIGNMARKETS2/$SETUNDERLYIGNMARKET2/g; s/SETMARKETCLUSTERS1/$SETMARKETCLUSTERS1/g; s/NUMNORMALLOCAL/$NUMNORMALLOCAL/g; s/NUMOPTIONAGENT/$NUMOPTIONAGENT/g; s/SETCASHLOCAL/$SETCASHLOCAL/g; s/NUMBASELLOCAL/$NUMBASELLOCAL/g; s/NUMGOODS/$NUMGOODS/g; s/SETCASHPORT/$SETCASHPORT/g; s/NUMNORMALPORT/$NUMNORMALPORT/g; s/NUMBASELPORT/$NUMBASELPORT/g; s/SETNUMOPTION/$SETNUMOPTION/g; s/SETUNDERLYIGNMARKETS1/$SETUNDERLYIGNMARKET1/g; s/SETNORMALLOCALAGENT1/$SETNORMALLOCALAGENT1/g; s/SETBASELLOCALAGENT1/$SETBASELLOCALAGENT1/g; s/SETOPTIONAGENT1/$SETOPTIONAGENT1/g" $HOME/programX10/plham-dev/samples/OptionPortfolio/optionPortfolioMain.json > ./BaselR$1-G$2-baselrate$3-seed$4.json

$HOME/programX10/plham-dev/OptionPortfolioMain.out ./BaselR$1-G$2-baselrate$3-seed$4.json $4


